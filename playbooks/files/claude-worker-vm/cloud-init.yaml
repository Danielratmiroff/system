#cloud-config

users:
  - default
  - name: ubuntu
    sudo: ALL=(ALL) NOPASSWD:ALL
    shell: /bin/bash
    ssh_authorized_keys:
      - {{ ssh_public_key }}

package_update: true

packages:
  - xauth
  - x11-apps
  - curl
  - git
  - build-essential
  - bubblewrap

runcmd:
  # Configure SSH for X11 forwarding
  - sed -i 's/#X11Forwarding.*/X11Forwarding yes/' /etc/ssh/sshd_config
  - sed -i 's/#X11UseLocalhost.*/X11UseLocalhost no/' /etc/ssh/sshd_config
  - systemctl restart sshd
  # Install Google Chrome (official .deb, works with X11 forwarding)
  - wget -q https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb -O /tmp/chrome.deb
  - apt-get install -y /tmp/chrome.deb
  - rm /tmp/chrome.deb
  # Install Node.js and Claude Code
  - curl -fsSL https://deb.nodesource.com/setup_22.x | bash -
  - apt-get install -y nodejs
  - npm install -g @anthropic-ai/claude-code
  - sudo -u ubuntu git config --global user.name "danielr"
  - sudo -u ubuntu git config --global user.email "danielratmiroff@gmail.com"
